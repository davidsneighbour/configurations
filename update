#!/bin/bash

REQUIRED_TOOLS=(
  npm
  git
  npm-check-updates
)

for TOOL in "${REQUIRED_TOOLS[@]}"; do
  if ! command -v "${TOOL}" >/dev/null; then
    echo "${TOOL} is required... "
    exit 1
  fi
done

SCRIPTPATH="$(
  cd "$(dirname "$0")" >/dev/null 2>&1 || exit
  pwd -P
)"

PACKAGES=(
  eslint-config
  remark-config
  textlint-config
  commitlint-config
  browserslist-config
  config
)

for PACKAGE in "${PACKAGES[@]}"; do
    dir=${PACKAGE%*/}
    echo "Updating ${dir}"
    cd "${SCRIPTPATH}"/packages/"${dir}" || exit
    npm-check-updates -u
    if [[ $(git status --porcelain --untracked-files=no) ]]; then
      npm install
      echo "Updating dependencies and releasing"
      git add package.json
      git commit -m "chore(deps): update dependencies for ${dir}"
      ../../release
    fi
    echo
done

cd "${SCRIPTPATH}" || exit
